FROM node:8.11-alpine

ARG DB_USERNAME
ARG DB_PASSWORD  
ARG DB_NAME  
ARG DB_HOST 
ARG DB_ENV 

ENV DEVOPS_TEST_DATABASE_NAME=${DB_NAME} \
    DEVOPS_TEST_DATABASE_HOST=${DB_HOST} \
    DEVOPS_TEST_ENV=${DB_ENV} \
    DEVOPS_TEST_DATABASE_USERNAME=${DB_USERNAME} \
    DEVOPS_TEST_DATABASE_PASSWORD=${DB_PASSWORD} 
WORKDIR /app

COPY package.json .

RUN npm install

COPY . /app

RUN npm run migrate-up

ENTRYPOINT 3082

CMD ["npm", "run", "start"]

